# DIBO API v1 Documentation

## Overview

The DIBO (Diablo Immortal Build Optimizer) API provides endpoints for managing
and optimizing character builds in Diablo Immortal. This RESTful API follows
standard HTTP conventions and uses JSON for request and response payloads.

## Base URL

The base URL for all API endpoints is:

```
https://api.dibo.cloud/v1
```

## Authentication

Authentication is handled via GitHub OAuth 2.0. All authenticated endpoints 
require a Bearer token in the Authorization header:

```
Authorization: Bearer <jwt_token>
```

### Authentication Flow

1. **Start OAuth Flow**

**GET /auth/github/login**

Initiates the GitHub OAuth flow by generating a state token and authorization URL.

**Response:**

```json
{
    "url": "https://github.com/login/oauth/authorize?client_id=...",
    "state": "random_state_token"
}
```

2. **Exchange Code for Token**

**POST /auth/github**

**Request Body:**

```json
{
    "code": "string",
    "state": "string"
}
```

**Response:**

```json
{
    "access_token": "string",
    "token_type": "bearer",
    "scope": "string",
    "user": {
        "id": "string",
        "username": "string",
        "avatar_url": "string",
        "name": "string",
        "email": "string"
    }
}
```

3. **Get User Profile**

**GET /auth/user**

**Headers:**

```
Authorization: Bearer <jwt_token>
```

**Response:**

```json
{
    "id": "string",
    "username": "string",
    "avatar_url": "string",
    "name": "string",
    "email": "string"
}
```

## Rate Limiting

The API implements rate limiting to ensure fair usage:
- Authenticated requests: 1000 requests per hour
- Unauthenticated requests: 60 requests per hour

Rate limit information is included in response headers:

X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1704330000

### Field Selection

Use `fields` parameter to select specific fields:

GET /api/v1/builds?fields=id,name,character_class

## Build Management

### Create Build

**POST /builds**

**Request Headers:**
Authorization: Bearer <token>
Content-Type: application/json

**Request Body:**

```json
{
    "name": "string",
    "description": "string",
    "character_class": "string",
    "build_type": "string",
    "goals": ["damage", "survival", "utility"],
    "focus": "pve|pvp",
    "is_private": boolean,
    "primary_gems": [
        {
            "name": "string",
            "rank": number,
            "stars": number,
            "quality": number
        }
    ],
    "aux_gems": [
        {
            "name": "string",
            "rank": number,
            "stars": number,
            "quality": number
        }
    ],
    "skills": [
        {
            "name": "string",
            "slot": number,
            "variants": ["string"]
        }
    ],
    "sets": [
        {
            "name": "string",
            "pieces": number
        }
    ]
}
```

**Response:** (201 Created)

```json
{
    "id": "string",
    "created_at": "string",
    "updated_at": "string",
    "owner": {
        "id": "string",
        "username": "string"
    },
    "name": "string",
    "description": "string",
    "character_class": "string",
    "build_type": "string",
    "goals": ["damage", "survival", "utility"],
    "focus": "pve|pvp",
    "is_private": boolean,
    "primary_gems": [
        {
            "name": "string",
            "rank": number,
            "stars": number,
            "quality": number
        }
    ],
    "aux_gems": [
        {
            "name": "string",
            "rank": number,
            "stars": number,
            "quality": number
        }
    ],
    "skills": [
        {
            "name": "string",
            "slot": number,
            "variants": ["string"]
        }
    ],
    "sets": [
        {
            "name": "string",
            "pieces": number
        }
    ]
}
```

## CORS Support

The API supports Cross-Origin Resource Sharing (CORS) for all origins in
development and specified origins in production.

**Response Headers:**

Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Headers: Authorization, Content-Type
Access-Control-Allow-Credentials: true

## Error Responses

**400 Bad Request**

```json
{
    "detail": "Invalid request body"
}
```

**401 Unauthorized**

```json
{
    "detail": "Not authenticated"
}
```

**403 Forbidden**

```json
{
    "detail": "Invalid state token"
}
```

**422 Unprocessable Entity**

```json
{
    "detail": "Validation error"
}
```

**429 Too Many Requests**

```json
{
    "detail": "Rate limit exceeded"
}
```

## Build Management

### List Builds

**GET /builds**

**Query Parameters:**
- Standard pagination parameters
- `character_class`: Filter by class
- `build_type`: Filter by type
- `owner`: Filter by owner username
- `include_private`: Include private builds (only for authenticated user)
- `sort`: Sort field (created_at, updated_at, popularity)
- `order`: Sort order (asc, desc)

**Response:** (200 OK)

```json
{
    "items": [
        {
            "id": "string",
            "created_at": "string",
            "updated_at": "string",
            "owner": {
                "id": "string",
                "username": "string"
            },
            "name": "string",
            "description": "string",
            "character_class": "string",
            "build_type": "string",
            "goals": ["damage", "survival", "utility"],
            "focus": "pve|pvp",
            "is_private": boolean,
            "primary_gems": [
                {
                    "name": "string",
                    "rank": number,
                    "stars": number,
                    "quality": number
                }
            ],
            "aux_gems": [
                {
                    "name": "string",
                    "rank": number,
                    "stars": number,
                    "quality": number
                }
            ],
            "skills": [
                {
                    "name": "string",
                    "slot": number,
                    "variants": ["string"]
                }
            ],
            "sets": [
                {
                    "name": "string",
                    "pieces": number
                }
            ]
        }
    ],
    "total": number,
    "page": number,
    "per_page": number
}
```

## Common Parameters

### Pagination

For endpoints that return collections, the following parameters are available:

**Query Parameters:**

- `page`: Page number (default: 1)
- `per_page`: Items per page (default: 20, max: 100)

**Response Headers:**

```
X-Total-Count: 100
Link: <https://api.dibo.cloud/v1/builds?page=2>; rel="next",
      <https://api.dibo.cloud/v1/builds?page=5>; rel="last"
```

### Filtering

Common filter parameters:

- `character_class`: Filter by class name
- `build_type`: Filter by build type
- `created_after`: ISO 8601 datetime
- `created_before`: ISO 8601 datetime

### Field Selection

Use `fields` parameter to select specific fields:

```
GET /api/v1/builds?fields=id,name,character_class
```

## Endpoint Overview

### Authentication

- `GET /auth/github/login`: Start GitHub OAuth flow
- `POST /auth/github`: Exchange GitHub OAuth code for access token
- `GET /auth/user`: Get authenticated user profile

### Build Management

- `GET /builds`: List builds
- `POST /builds`: Create a new build
- `GET /builds/:id`: Get a specific build
- `PUT /builds/:id`: Update a build
- `DELETE /builds/:id`: Delete a build

### Build Generation & Analysis

- `POST /builds/generate`: Generate an optimized build
- `POST /analyze/synergy`: Calculate synergy scores
- `POST /analyze/gear`: Analyze gear optimization
- `POST /builds/compare`: Compare multiple builds

### Game Data

- `GET /data/metadata`: Get game data version info
- `GET /data/constraints`: Get system constraints
- `GET /data/skills/:class`: Get class skills
- `GET /data/gems`: Get gem data
- `GET /data/sets`: Get set bonus info
- `GET /data/curses`: Get curse set bonuses
- `GET /data/enchantments`: Get enchantment effects
- `GET /data/reforges`: Get reforge attributes
- `GET /data/stats`: Get stat relationships
- `GET /data/synergies`: Get synergy definitions
- `GET /data/cross-references`: Get element relationships

### Player Data

- `GET /data/player/inventory`: Get player's inventory
