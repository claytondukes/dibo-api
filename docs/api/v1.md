# DIBO API v1 Documentation

## Overview

The DIBO (Diablo Immortal Build Optimizer) API provides endpoints for managing
and optimizing character builds in Diablo Immortal. This RESTful API follows
standard HTTP conventions and uses JSON for request and response payloads.

## Base URL

```
https://api.dibo.cloud/v1
```

## Authentication

Authentication is handled via GitHub OAuth 2.0. All authenticated endpoints 
require a Bearer token in the Authorization header:

```
Authorization: Bearer <jwt_token>
```

### Authentication Endpoints

#### 1. Start OAuth Flow 
**GET /auth/github/login**

Initiates the GitHub OAuth flow.

**Response:**
```json
{
    "auth_url": "https://github.com/login/oauth/authorize?client_id=...",
    "state": "random_state_token"
}
```

#### 2. Exchange Code for Token 
**POST /auth/github**

**Request:**
```json
{
    "code": "string",
    "state": "string"
}
```

**Response:**
```json
{
    "access_token": "string",
    "token_type": "bearer",
    "scope": "string",
    "user": {
        "id": "string",
        "username": "string",
        "avatar_url": "string",
        "name": "string",
        "email": "string"
    }
}
```

#### 3. Get User Profile 
**GET /auth/user**

**Response:**
```json
{
    "id": "string",
    "username": "string",
    "avatar_url": "string",
    "name": "string",
    "email": "string"
}
```

## Data Endpoints

### Stats
**GET /data/stats**

Returns available stats with their gem and essence modifiers.

**Response:**
```json
{
    "critical_hit_chance": {
        "gems": [
            {
                "name": "Berserker's Eye",
                "stars": "1",
                "base_values": [],
                "rank_10_values": [
                    {
                        "conditions": [],
                        "value": 2.0,
                        "unit": "percentage",
                        "scaling": false
                    }
                ],
                "conditions": [],
                "rank_10_conditions": []
            }
        ],
        "essences": []
    }
}
```

### Synergies
**GET /data/synergies**

Returns synergy information for gems, essences, and skills.

**Response:**
```json
{
    "critical_hit": {
        "gems": ["Berserker's Eye", "Cutthroat's Grin"],
        "essences": [],
        "skills": [],
        "conditions": {
            "Cutthroat's Grin": [
                {
                    "type": "trigger",
                    "trigger": "on_attack",
                    "text": "when attack"
                }
            ]
        }
    }
}
```

### Class Data
**GET /data/classes/{class_name}**

Returns class-specific data including skills and essences.

**Parameters:**
- `class_name`: Class name (e.g., "barbarian")

**Response:**
```json
{
    "base_skills": {
        "Whirlwind": {
            "base_type": "primary",
            "description": "Spin with blades..."
        }
    },
    "essences": {
        "Whirlwind": {
            "Gale Force": {
                "type": "legendary",
                "slot": "chest",
                "effect": "Increases movement speed..."
            }
        }
    }
}
```

### Equipment Data
**GET /data/equipment/sets**

Returns information about equipment sets and their bonuses.

**Response:**
```json
{
    "sets": {
        "Grace of the Flagellant": {
            "pieces": ["Helm", "Chest"],
            "bonuses": {
                "2": "Increases damage...",
                "4": "Increases attack speed..."
            }
        }
    }
}
```

## Build Management

### Generate Build
**POST /builds/generate**

Generates an optimized build based on parameters.

**Request:**
```json
{
    "class": "barbarian",
    "focus": "DPS",
    "build_type": "RAID",
    "inventory": {
        "gems": [
            {"name": "Berserker's Eye", "rank": 5}
        ]
    }
}
```

**Response:**
```json
{
    "skills": [
        {
            "name": "Whirlwind",
            "essence": "Gale Force"
        }
    ],
    "gems": [
        {
            "name": "Berserker's Eye",
            "rank": 5
        }
    ],
    "equipment": {
        "sets": [
            {
                "name": "Grace of the Flagellant",
                "pieces": ["Helm", "Chest"]
            }
        ]
    }
}
```

### Analyze Build
**POST /builds/analyze**

Analyzes an existing build and provides optimization suggestions.

**Request:**
```json
{
    "class": "barbarian",
    "skills": [...],
    "gems": [...],
    "equipment": {...}
}
```

**Response:**
```json
{
    "score": 85.5,
    "analysis": {
        "strengths": [...],
        "weaknesses": [...],
        "suggestions": [...]
    }
}
```

## Error Handling

All endpoints follow standard HTTP status codes:

- 200: Success
- 400: Bad Request
- 401: Unauthorized
- 403: Forbidden
- 404: Not Found
- 500: Internal Server Error

Error responses include a detail message:
```json
{
    "detail": "Error description"
}
```
